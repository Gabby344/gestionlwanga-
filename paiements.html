<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Enregistrement Paiement - Institut Saint Charles Lwanga (SIGS)</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bleu-fonce: #1e40af; 
      --gris-fonce: #1f2937;
      --vert-finance: #047857; /* Accent Principal */
      --rouge-danger: #ef4444; 
      --fond-principal: #f4f6f8;
      --gris-bordure: #d1d5db; 
      --ombre-form: rgba(0,0,0,0.1);
    }
    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--fond-principal);
      margin: 0;
      padding: 2rem 1rem;
      color: var(--gris-fonce);
    }
    h1 {
      text-align: center;
      font-size: 1.8rem;
      color: var(--bleu-fonce);
      margin-bottom: 0.5rem;
    }
    h2 {
      text-align: center;
      font-size: 1rem;
      font-weight: normal;
      color: #6b7280;
      margin-bottom: 2rem;
    }
    .container {
        max-width: 900px;
        margin: auto;
    }

    /* --- RECHERCHE ET R√âSULTAT --- */
    .search-card, .payment-card {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px var(--ombre-form);
      margin-bottom: 1.5rem;
    }
    .search-input-group {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    #searchInput {
      flex-grow: 1;
      padding: 0.9rem;
      border: 1px solid var(--gris-bordure);
      border-radius: 8px;
      font-size: 1rem;
      background-color: #f9fafb;
    }
    .btn-search {
        padding: 0.9rem 1.5rem;
        background-color: var(--bleu-fonce);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: background-color 0.2s;
    }
    .btn-search:hover { background-color: #1f3a8a; }

    /* --- ZONE D'INFORMATION √âL√àVE (R√âSULTAT) --- */
    #eleveInfo {
        padding: 1rem 0;
        margin-top: 1rem;
        border-top: 1px solid #f3f4f6;
        display: none; /* Affich√© par JS apr√®s recherche */
        text-align: left;
    }
    .info-line {
        display: flex;
        justify-content: space-between;
        padding: 0.3rem 0;
        font-size: 1.05rem;
    }
    .info-line strong {
        font-weight: 700;
    }
    #solde {
        font-size: 1.5rem;
    }
    .solde-positif { color: var(--vert-finance); }
    .solde-negatif { color: var(--rouge-danger); }

    /* --- FORMULAIRE DE PAIEMENT --- */
    .payment-card {
        border-left: 5px solid var(--vert-finance);
        display: none; /* Affich√© seulement si √©l√®ve trouv√© */
    }
    .form-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.5rem; 
    }
    @media (min-width: 600px) {
        .form-grid {
            grid-template-columns: 1fr 1fr; /* 2 colonnes sur desktop */
        }
    }
    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
    }
    input[type="number"], select {
      width: 100%;
      padding: 0.9rem;
      border: 1px solid var(--gris-bordure);
      border-radius: 8px; 
      box-sizing: border-box;
      font-size: 1rem;
    }
    input:focus, select:focus {
        border-color: var(--vert-finance);
        box-shadow: 0 0 0 3px rgba(4, 120, 87, 0.1);
        outline: none;
    }
    
    /* --- BOUTON D'ACTION PRINCIPAL --- */
    .btn-register-payment {
      grid-column: 1 / -1; 
      background-color: var(--vert-finance);
      color: white;
      font-weight: 700;
      padding: 1rem;
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      cursor: pointer;
      margin-top: 1rem;
      transition: background-color 0.2s;
    }
    .btn-register-payment:hover {
      background-color: #059669;
    }
    
    #paymentMessage {
      margin-top: 1.5rem;
      text-align: center;
      font-weight: 600;
    }

    .btn-retour {
        display: block;
        text-align: center;
        margin-top: 2rem;
        color: var(--gris-fonce);
        text-decoration: none;
        font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üíµ Enregistrement d'un Nouveau Paiement</h1>
    <h2>Recherchez l'√©l√®ve par nom ou matricule pour enregistrer la transaction de scolarit√©.</h2>

    <div class="search-card">
        <div class="search-input-group">
            <input type="text" id="searchInput" placeholder="Entrez Nom, Pr√©nom ou Matricule de l'√©l√®ve..." />
            <button class="btn-search" onclick="searchEleve()">üîç Rechercher</button>
        </div>

        <div id="eleveInfo">
            </div>
        <p id="searchMessage" style="margin-top: 1rem; font-weight: 600; color: var(--gris-fonce);"></p>
    </div>

    <div class="payment-card" id="paymentSection">
        <h3>Enregistrer la Transaction</h3>
        <form id="paymentForm">
            <div class="form-grid">
                
                <div class="form-group">
                    <label for="montant">Montant Pay√© (USD) *</label>
                    <input type="number" id="montant" min="1" placeholder="Ex: 50.00" required />
                </div>
                
                <div class="form-group">
                    <label for="typePaiement">Mode de Paiement *</label>
                    <select id="typePaiement" required>
                        <option value="">-- S√©lectionner --</option>
                        <option value="Cash">Esp√®ces (Cash)</option>
                        <option value="Virement">Virement Bancaire</option>
                        <option value="Mobile">Paiement Mobile</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="motif">Motif du Paiement *</label>
                    <select id="motif" required>
                        <option value="">-- S√©lectionner --</option>
                        <option value="Minerval">Minerval (Frais Scolaires)</option>
                        <option value="Inscription">Frais d'Inscription</option>
                        <option value="Examen">Frais d'Examen</option>
                        <option value="Divers">Frais Divers</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="datePaiement">Date de la Transaction *</label>
                    <input type="date" id="datePaiement" required />
                </div>
                
                <button type="submit" class="btn-register-payment">
                    ‚úÖ Valider et Imprimer le Re√ßu
                </button>
            </div>
        </form>
        <p id="paymentMessage"></p>
    </div>

    <a href="finance.html" class="btn-retour">‚Üê Retour au Menu Gestion Financi√®re</a>
  </div>

  <script>
    // --- SIMULATION DE DONN√âES ET FONCTIONS ---
    
    // Simule la base de donn√©es des √©l√®ves et leurs soldes
    const elevesDB = {
        '25/6A-101': { nom: 'UMBA Gabby', classe: '6A', soldeDu: 200.00 },
        '25/5S-102': { nom: 'KABULO Ndaya', classe: '5S', soldeDu: 0.00 },
        '25/6A-103': { nom: 'MUTOMBO Kalubi', classe: '6A', soldeDu: 50.00 },
        // ...
    };

    let currentEleveMatricule = null;

    function searchEleve() {
        const input = document.getElementById('searchInput').value.trim().toUpperCase();
        const infoDiv = document.getElementById('eleveInfo');
        const searchMsg = document.getElementById('searchMessage');
        const paymentSection = document.getElementById('paymentSection');
        
        infoDiv.style.display = 'none';
        paymentSection.style.display = 'none';
        searchMsg.textContent = 'Recherche en cours...';

        // Logique de recherche (simulation)
        const eleve = Object.entries(elevesDB).find(([matricule, data]) => 
            matricule === input || data.nom.toUpperCase().includes(input)
        );

        setTimeout(() => { // Simuler un d√©lai de chargement
            if (eleve) {
                const [matricule, data] = eleve;
                currentEleveMatricule = matricule;
                searchMsg.textContent = '‚úÖ √âl√®ve trouv√©.';
                renderEleveInfo(matricule, data);
                paymentSection.style.display = 'block';
            } else {
                searchMsg.style.color = 'var(--rouge-danger)';
                searchMsg.textContent = '‚ùå Aucun √©l√®ve trouv√© avec ce crit√®re.';
                currentEleveMatricule = null;
            }
        }, 500);
    }

    function renderEleveInfo(matricule, data) {
        const infoDiv = document.getElementById('eleveInfo');
        const soldeClass = data.soldeDu > 0 ? 'solde-negatif' : 'solde-positif';
        const statutSolde = data.soldeDu > 0 ? `${data.soldeDu.toFixed(2)} USD` : 'Solde Nul / Paiement Anticip√©';

        infoDiv.innerHTML = `
            <div class="info-line">
                <span>Nom et Pr√©nom:</span>
                <strong>${data.nom}</strong>
            </div>
            <div class="info-line">
                <span>Matricule / Classe:</span>
                <strong>${matricule} / ${data.classe}</strong>
            </div>
            <div class="info-line">
                <span>Solde √† payer (Minerval):</span>
                <strong id="solde" class="${soldeClass}">${statutSolde}</strong>
            </div>
        `;
        infoDiv.style.display = 'block';
        document.getElementById('montant').max = data.soldeDu > 0 ? data.soldeDu : ''; // Limite de saisie si solde d√ª
    }

    document.getElementById('paymentForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (!currentEleveMatricule) {
            alert("Veuillez d'abord rechercher et s√©lectionner un √©l√®ve.");
            return;
        }

        const montant = parseFloat(document.getElementById('montant').value);
        const typePaiement = document.getElementById('typePaiement').value;
        const motif = document.getElementById('motif').value;
        const datePaiement = document.getElementById('datePaiement').value;
        const messageBox = document.getElementById('paymentMessage');

        // --- SIMULATION DE L'ENREGISTREMENT ---
        console.log('Transaction enregistr√©e:', {
            matricule: currentEleveMatricule,
            montant,
            motif,
            typePaiement,
            date: datePaiement
        });
        
        const nouvelSolde = elevesDB[currentEleveMatricule].soldeDu - montant;
        
        messageBox.style.color = 'var(--vert-finance)';
        messageBox.innerHTML = `
            ‚úÖ **Paiement de ${montant.toFixed(2)} USD enregistr√© pour ${elevesDB[currentEleveMatricule].nom}.**<br>
            Impression du re√ßu en cours... Nouveau solde: ${nouvelSolde.toFixed(2)} USD.
        `;

        // Mise √† jour de l'interface et r√©initialisation du formulaire
        elevesDB[currentEleveMatricule].soldeDu = nouvelSolde; // Mettre √† jour la simulation
        document.getElementById('paymentForm').reset();
        
        // Mettre √† jour les infos √©l√®ve affich√©es
        renderEleveInfo(currentEleveMatricule, elevesDB[currentEleveMatricule]);
    });
    
    // D√©finir la date par d√©faut sur la date du jour
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('datePaiement').valueAsDate = new Date();
    });

  </script>
</body>
</html>
