<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dashboard Â· ISC Lwanga</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --bleu-fonce: #1e40af;
  --gris-fonce: #1f2937;
  --vert: #10b981;
  --jaune: #f59e0b;
  --rouge: #ef4444;
  --fond: #f4f6f8;
  --ombre-legere: rgba(0,0,0,0.08);
}
body {
  font-family: 'Inter', sans-serif;
  background-color: var(--fond);
  margin: 0;
  color: var(--gris-fonce);
}
.header {
  background:white;
  padding:1rem 2rem;
  box-shadow:0 1px 5px var(--ombre-legere);
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
  gap:1rem;
}
.header-left {display:flex; align-items:center; gap:1rem;}
.header img {height:50px;width:50px; object-fit:contain;}
.header h1 {font-size:1.5rem;color:var(--bleu-fonce); margin:0; font-weight:700;}
.user-info {font-size:0.95rem;color:#374151;font-weight:500;}
.btn-logout {
  background-color: var(--rouge);
  color:white;
  padding:0.6rem 1rem;
  border:none;
  border-radius:6px;
  font-weight:600;
  cursor:pointer;
  transition:background-color 0.2s;
}
.btn-logout:hover {background-color:#b91c1c;}
.main-content {max-width:1200px;margin:auto;padding:1rem;}
.section-title {font-size:1.3rem;font-weight:700;color:var(--gris-fonce);margin-bottom:1rem;padding-bottom:0.5rem;border-bottom:1px solid #e5e7eb;}
.stats-grid {display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:1.5rem; margin-bottom:2rem;}
.card-stat {background:white; padding:1.5rem; border-radius:12px; box-shadow:0 4px 10px var(--ombre-legere); border-left:5px solid var(--bleu-fonce); transition: transform 0.2s;}
.card-stat:hover {transform:translateY(-3px); box-shadow:0 6px 15px rgba(0,0,0,0.15);}
.card-stat-title {font-size:0.85rem;font-weight:600;color:#6b7280;text-transform:uppercase;margin-bottom:0.5rem;}
.card-stat-value {font-size:2.5rem;font-weight:800;color:var(--gris-fonce); line-height:1;}
.card-stat-footer {font-size:0.8rem;color:#9ca3af;margin-top:1rem;}
.stat-bleu {border-left-color:var(--bleu-fonce);}
.stat-vert {border-left-color:var(--vert);}
.stat-jaune {border-left-color:var(--jaune);}
.stat-rouge {border-left-color:var(--rouge);}
.menu-grid {display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:1.5rem;}
.menu-item {
  background:white; padding:1.5rem; border-radius:10px;
  box-shadow:0 3px 6px var(--ombre-legere);
  text-align:center; text-decoration:none; color:var(--gris-fonce);
  transition:all 0.2s; border:1px solid #e5e7eb; font-weight:600;
}
.menu-item:hover {background-color:var(--bleu-fonce); color:white; border-color:var(--bleu-fonce); transform:scale(1.05);}
.menu-item .icon {font-size:2.5rem; margin-bottom:0.5rem;}
@media(max-width:600px){.header-left h1{font-size:1.2rem;}.card-stat-value{font-size:2rem;}.menu-item .icon{font-size:2rem;}}
</style>
</head>
<body>

<div class="header">
  <div class="header-left">
    <img src="IMG_7373.jpeg" alt="Logo ISC Lwanga">
    <h1 id="dashboardTitle">Dashboard Â· ISC Lwanga</h1>
  </div>
  <div class="user-info" id="userInfo"></div>
  <button class="btn-logout" id="logoutBtn">ðŸšª DÃ©connexion</button>
</div>

<div class="main-content">
  <h2 class="section-title">AperÃ§u Actuel</h2>
  <div class="stats-grid" id="statsGrid"></div>

  <h2 class="section-title">Modules de Gestion</h2>
  <div class="menu-grid" id="menuGrid"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

// Config Firebase
const firebaseConfig = {
  apiKey: "AIzaSyAgv4TDYnR60TXnns-LISqbZTgcdLT31cc",
  authDomain: "gestionlwanga.firebaseapp.com",
  projectId: "gestionlwanga",
  storageBucket: "gestionlwanga.firebasestorage.app",
  messagingSenderId: "622604298611",
  appId: "1:622604298611:web:4ab4314ed3eec6826c3d06"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const dashboardTitle = document.getElementById("dashboardTitle");
const userInfo = document.getElementById("userInfo");
const logoutBtn = document.getElementById("logoutBtn");
const statsGrid = document.getElementById("statsGrid");
const menuGrid = document.getElementById("menuGrid");

// Dashboard menus
const roleModules = {
  admin: ["eleves","enseignants","bulletins","cours","paiements","admin"],
  prefet: ["eleves","enseignants","bulletins","cours","paiements","admin"],
  econome: ["paiements"],
  directeur_etudes: ["eleves","bulletins","cours"],
  directeur_discipline: ["bulletins","cours"],
  secretaire: ["eleves"]
};

const moduleLinks = {
  eleves: {title:"Gestion des Ã‰lÃ¨ves", icon:"ðŸ“š", link:"liste-eleves.html"},
  enseignants: {title:"Gestion des Enseignants", icon:"ðŸ‘¨â€ðŸ«", link:"liste-enseignants.html"},
  bulletins: {title:"Notes & Bulletins", icon:"ðŸ§®", link:"bulletins.html"},
  cours: {title:"Planning des Cours", icon:"ðŸ“†", link:"cours.html"},
  paiements: {title:"Suivi des Paiements", icon:"ðŸ’°", link:"paiements.html"},
  admin: {title:"ParamÃ¨tres Admin", icon:"âš™ï¸", link:"admin.html"}
};

// Notifications
function showNotification(msg,type="success"){
  const notif = document.createElement("div");
  notif.className = `notification ${type}`;
  notif.style.cssText = "position:fixed;top:20px;right:20px;padding:1rem 1.5rem;border-radius:8px;margin-bottom:10px;box-shadow:0 4px 6px rgba(0,0,0,0.1);color:white;font-weight:500;z-index:1000;";
  notif.textContent = msg;
  if(type==="success") notif.style.backgroundColor="var(--vert)";
  if(type==="error") notif.style.backgroundColor="var(--rouge)";
  document.body.appendChild(notif);
  setTimeout(()=>notif.remove(),4000);
}

// VÃ©rification Auth
onAuthStateChanged(auth, async (user)=>{
  if(!user){ window.location.href="admin.html"; return; }
  try{
    const snap = await getDoc(doc(db,"users",user.uid));
    if(!snap.exists()) throw new Error("Profil introuvable.");
    const data = snap.data();
    const role = (data.role||"inconnu").toLowerCase();
    const nom = [data.nom,data.postNom,data.prenom].filter(Boolean).join(" ")||"Utilisateur";

    dashboardTitle.textContent = `Dashboard Â· ${role.toUpperCase()} Â· ISC Lwanga`;
    userInfo.textContent = `${nom} (${role})`;

    // Statistiques
    const statsData = [
      {title:"Ã‰lÃ¨ves Inscrits", value:1245, footer:"+5 ce mois", color:"stat-bleu"},
      {title:"Enseignants Actifs", value:48, footer:"Taux : 98%", color:"stat-vert"},
      {title:"Notes Ã  Saisir", value:"3 classes", footer:"Deadline : 15 oct", color:"stat-jaune"},
      {title:"Frais ImpayÃ©s", value:22, footer:"Total dÃ» : $5,400", color:"stat-rouge"}
    ];
    statsGrid.innerHTML="";
    statsData.forEach(stat=>{
      const card=document.createElement("div");
      card.className=`card-stat ${stat.color}`;
      card.innerHTML=`<p class="card-stat-title">${stat.title}</p><p class="card-stat-value">${stat.value}</p><p class="card-stat-footer">${stat.footer}</p>`;
      statsGrid.appendChild(card);
    });

    // Menu modules
    menuGrid.innerHTML="";
    const modules = roleModules[role]||[];
    modules.forEach(mod=>{
      const m = moduleLinks[mod];
      if(m){
        const item=document.createElement("a");
        item.href=m.link;
        item.className="menu-item";
        item.innerHTML=`<div class="icon">${m.icon}</div><div>${m.title}</div>`;
        menuGrid.appendChild(item);
      }
    });

    if(modules.length===0){
      showNotification("â›” RÃ´le non autorisÃ©","error");
      await signOut(auth);
      window.location.href="admin.html";
    }

  }catch(err){
    console.error(err);
    showNotification(err.message,"error");
    await signOut(auth);
    window.location.href="admin.html";
  }
});

// DÃ©connexion
logoutBtn.addEventListener("click", async ()=>{
  try{
    await signOut(auth);
    showNotification("âœ… DÃ©connexion rÃ©ussie !");
    setTimeout(()=>window.location.href="admin.html",500);
  }catch(err){
    console.error(err);
    showNotification("Erreur lors de la dÃ©connexion","error");
  }
});
</script>
</body>
</html>
