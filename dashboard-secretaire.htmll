<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Secr√©taire ¬∑ Institut Saint Charles Lwanga</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bleu-fonce:#1e40af;
  --gris-fonce:#1f2937;
  --vert:#10b981;
  --fond:#f4f6f8;
  --ombre:rgba(0,0,0,0.08);
}
body{margin:0;padding:0;font-family:'Inter',sans-serif;background:var(--fond);color:var(--gris-fonce);}
.header{background:white;padding:1rem 2rem;box-shadow:0 1px 5px var(--ombre);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;}
.header h1{margin:0;color:var(--bleu-fonce);}
.header .user-info{font-weight:500;color:#374151;}
.btn-logout{background:#ef4444;color:white;padding:0.6rem 1rem;border:none;border-radius:6px;cursor:pointer;}
.main{max-width:900px;margin:2rem auto;padding:2rem;background:white;border-radius:12px;box-shadow:0 4px 12px var(--ombre);}
h2{margin-top:0;text-align:center;color:var(--bleu-fonce);}
.form-group{margin-bottom:1rem;}
label{display:block;font-weight:600;margin-bottom:0.3rem;}
input, select{width:100%;padding:0.6rem;border:1px solid #d1d5db;border-radius:6px;}
input:focus, select:focus{outline:none;border-color:var(--bleu-fonce);box-shadow:0 0 0 2px rgba(30,64,175,0.2);}
.btn-submit{width:100%;padding:1rem;background:var(--vert);color:white;border:none;border-radius:8px;font-weight:700;cursor:pointer;margin-top:1rem;}
.table-container{margin-top:2rem;overflow-x:auto;}
table{width:100%;border-collapse:collapse;}
th, td{padding:0.75rem;text-align:left;border-bottom:1px solid #e5e7eb;}
th{background:#f3f4f6;font-weight:600;}
</style>
</head>
<body>

<div class="header">
  <h1>Dashboard Secr√©taire ¬∑ Institut Saint Charles Lwanga</h1>
  <div class="user-info" id="userInfo"></div>
  <button class="btn-logout" id="logoutBtn">üö™ D√©connexion</button>
</div>

<div class="main">
<h2>Inscription des √âl√®ves</h2>
<form id="form-eleve">
  <div class="form-group">
    <label>Nom :</label>
    <input type="text" id="nom" required>
  </div>
  <div class="form-group">
    <label>Postnom :</label>
    <input type="text" id="postnom" required>
  </div>
  <div class="form-group">
    <label>Pr√©nom :</label>
    <input type="text" id="prenom" required>
  </div>
  <div class="form-group">
    <label>Classe :</label>
    <select id="classe" required>
      <option value="">-- S√©lectionner une classe --</option>
      <option>7√®me EB</option>
      <option>8√®me EB</option>
      <option>1√®re Commerciales et Gestion</option>
      <option>2√®me Commerciales et Gestion</option>
      <option>3√®me Commerciales et Gestion</option>
      <option>4√®me Commerciales et Gestion</option>
      <option>1√®re Agriculture</option>
      <option>2√®me Agriculture</option>
      <option>3√®me Agriculture</option>
      <option>4√®me Agriculture</option>
      <option>1√®re Scientifique</option>
      <option>2√®me Scientifique</option>
      <option>3√®me Scientifique</option>
      <option>4√®me Scientifique</option>
      <option>1√®re P√©dagogie G√©n√©rale</option>
      <option>2√®me P√©dagogie G√©n√©rale</option>
      <option>3√®me P√©dagogie G√©n√©rale</option>
      <option>4√®me P√©dagogie G√©n√©rale</option>
    </select>
  </div>
  <div class="form-group">
    <label>Frais Restants ($) :</label>
    <input type="number" id="frais" value="0" min="0">
  </div>
  <button type="submit" class="btn-submit">‚úÖ Enregistrer l'√âl√®ve</button>
</form>

<div class="table-container">
  <table id="elevesTable">
    <thead>
      <tr>
        <th>Nom</th><th>Postnom</th><th>Pr√©nom</th><th>Classe</th><th>Frais Restants</th><th>Date Inscription</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAgv4TDYnR60TXnns-LISqbZTgcdLT31cc",
  authDomain: "gestionlwanga.firebaseapp.com",
  projectId: "gestionlwanga",
  storageBucket: "gestionlwanga.firebasestorage.app",
  messagingSenderId: "622604298611",
  appId: "1:622604298611:web:4ab4314ed3eec6826c3d06"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const userInfo = document.getElementById("userInfo");
const logoutBtn = document.getElementById("logoutBtn");
const form = document.getElementById("form-eleve");
const elevesTable = document.getElementById("elevesTable").querySelector('tbody');

onAuthStateChanged(auth, async user => {
  if(!user){ window.location.href="login.html"; return; }

  const snap = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js")
                    .then(m=>m.getDoc(m.doc(db,"users",user.uid)));
  const role = snap.data().role?.toLowerCase()??"";
  if(role !== "secretaire"){ signOut(auth); window.location.href="login.html"; return; }
  userInfo.textContent = `${snap.data().nom} ${snap.data().postNom} ${snap.data().prenom} (Secr√©taire)`;
});

// Ajouter un √©l√®ve
form.addEventListener("submit", async e=>{
  e.preventDefault();
  const data = {
    nom: document.getElementById("nom").value.trim(),
    postNom: document.getElementById("postnom").value.trim(),
    prenom: document.getElementById("prenom").value.trim(),
    classe: document.getElementById("classe").value,
    fraisRestants: parseFloat(document.getElementById("frais").value) || 0,
    dateInscription: new Date()
  };
  try{
    await addDoc(collection(db,"eleves"), data);
    alert("‚úÖ √âl√®ve enregistr√© !");
    form.reset();
  }catch(err){console.error(err); alert("Erreur lors de l'enregistrement");}
});

// Liste en temps r√©el
const q = query(collection(db,"eleves"), orderBy("dateInscription","desc"));
onSnapshot(q, snapshot=>{
  const eleves = snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));
  elevesTable.innerHTML = "";
  eleves.forEach(e=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${e.nom}</td><td>${e.postNom}</td><td>${e.prenom}</td><td>${e.classe}</td><td>${e.fraisRestants}</td><td>${new Date(e.dateInscription.seconds*1000).toLocaleDateString()}</td>`;
    elevesTable.appendChild(tr);
  });
});

// D√©connexion
logoutBtn.addEventListener("click", async ()=>{
  await signOut(auth);
  window.location.href="login.html";
});
</script>

</body>
</html>
