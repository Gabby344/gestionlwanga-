<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Enregistrer un Paiement - Institut Saint Charles Lwanga</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bleu-fonce: #1e40af;
      --gris-fonce: #1f2937;
      --indigo: #4f46e5; /* Couleur principale du module Paiements */
      --vert: #10b981; /* Bouton d'action positif */
      --fond: #f4f6f8;
      --ombre-legere: rgba(0,0,0,0.08);
    }
    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--fond);
      margin: 0;
      padding: 2rem 1rem;
      color: var(--gris-fonce);
    }
    h1 {
      text-align: center;
      font-size: 1.8rem;
      color: var(--bleu-fonce);
      margin-bottom: 0.5rem;
    }
    h2 {
      text-align: center;
      font-size: 1rem;
      font-weight: normal;
      color: #6b7280;
      margin-bottom: 2rem;
    }
    
    .container {
      max-width: 700px;
      margin: auto;
      background-color: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 10px var(--ombre-legere);
    }

    /* --- Formulaire & Champs --- */
    .form-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
    @media (min-width: 600px) {
        .form-grid {
            grid-template-columns: 1fr 1fr;
        }
    }
    .full-width {
        grid-column: 1 / -1;
    }
    
    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.3rem;
      font-size: 0.9rem;
    }
    input[type="text"], input[type="number"], select, input[type="date"] {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      box-sizing: border-box; 
      font-size: 1rem;
      background-color: #f9fafb;
    }
    input:focus, select:focus {
        border-color: var(--indigo);
        box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2);
        outline: none;
    }

    /* --- Statut & Montant --- */
    #montant-du-container {
        padding: 1rem;
        background-color: #eef2ff; /* Bleu très clair */
        border: 1px dashed var(--indigo);
        border-radius: 8px;
        margin-bottom: 2rem;
        text-align: center;
    }
    #montant-du-container p {
        margin: 0;
        font-weight: 600;
        color: var(--gris-fonce);
    }
    #montant-du-value {
        font-size: 1.8rem;
        color: var(--indigo);
        font-weight: 800;
        margin-top: 0.5rem;
    }

    /* --- Bouton d'Action Principale --- */
    .btn-enregistrer {
      display: block;
      width: 100%;
      padding: 1rem;
      margin-top: 2rem;
      background-color: var(--vert);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .btn-enregistrer:hover {
      background-color: #059669;
    }

    /* Bouton de retour */
    .btn-retour {
        display: block;
        text-align: center;
        margin-top: 1.5rem;
        color: var(--gris-fonce);
        text-decoration: none;
        font-size: 0.9rem;
        padding: 0.5rem;
    }
    .btn-retour:hover {
        color: var(--bleu-fonce);
    }
  </style>
</head>
<body>
  <h1>Enregistrer une Transaction</h1>
  <h2>Formulaire pour documenter un paiement de frais de scolarité.</h2>

  <div class="container">
    <form>
        <div class="form-grid">
            <div class="form-group full-width">
                <label for="recherche-eleve">Rechercher l'élève (Nom ou Matricule)</label>
                <input type="text" id="recherche-eleve" placeholder="Ex: GABBY UMBA ou 2025/001" oninput="simulerRecherche(this.value)" required>
            </div>
            
            <div class="form-group">
                <label for="eleve-selectionne">Élève trouvé :</label>
                <select id="eleve-selectionne" required onchange="mettreAJourStatut(this.value)">
                    <option value="">-- Veuillez rechercher un élève --</option>
                    <option value="ID001" selected>Gabby Umba (6ème Commerciale)</option>
                    <option value="ID002">Ndaya Kabulo (5ème Scientifique)</option>
                </select>
            </div>
             <div class="form-group">
                <label for="classe">Classe :</label>
                <input type="text" id="classe" value="6ème Commerciale" disabled>
            </div>
        </div>
        
        <hr class="full-width" style="border: 0; border-top: 1px solid #e5e7eb; margin: 2rem 0;">

        <div class="form-grid">
            
            <div id="montant-du-container" class="full-width">
                <p>Montant des frais de scolarité restants dus (Total) :</p>
                <div id="montant-du-value">$ 450.00</div>
            </div>
            
            <div class="form-group">
                <label for="montant-paye">Montant Payé aujourd'hui ($) *</label>
                <input type="number" id="montant-paye" min="0" value="150" required>
            </div>
            
            <div class="form-group">
                <label for="date-paiement">Date de la transaction *</label>
                <input type="date" id="date-paiement" value="2025-10-06" required>
            </div>

            <div class="form-group">
                <label for="methode">Méthode de paiement *</label>
                <select id="methode" required>
                    <option value="cash">Espèces</option>
                    <option value="bancaire">Virement Bancaire</option>
                    <option value="mobile">Paiement Mobile (M-Pesa, Airtel Money)</option>
                </select>
            </div>
             <div class="form-group">
                <label for="reference">Référence (Chèque/Transaction)</label>
                <input type="text" id="reference" placeholder="Optionnel">
            </div>
        </div>

        <button type="submit" class="btn-enregistrer" onclick="event.preventDefault(); simulerEnregistrement()">
            ✅ Enregistrer la transaction et imprimer le reçu
        </button>
    </form>
    
    <a href="paiements.html" class="btn-retour">← Retour au menu Gestion Financière</a>
  </div>

  <script>
    // Fonctions JS pour simuler le comportement du backend
    
    // Simule la recherche et la mise à jour des frais dus
    function mettreAJourStatut(eleveId) {
        const montantDu = document.getElementById('montant-du-value');
        const classeInput = document.getElementById('classe');
        const eleveSelect = document.getElementById('eleve-selectionne');
        const selectedOption = eleveSelect.options[eleveSelect.selectedIndex].text;
        
        let montant = 0;
        let classe = '';

        if (eleveId === 'ID001') {
            montant = 450.00;
            classe = '6ème Commerciale';
        } else if (eleveId === 'ID002') {
            montant = 800.00;
            classe = '5ème Scientifique';
        } else {
            montant = 0.00;
            classe = 'N/A';
        }
        
        montantDu.textContent = `$ ${montant.toFixed(2)}`;
        classeInput.value = classe;
        
        // Mettre à jour le bouton d'enregistrement avec le nom (UX Pro)
        document.querySelector('.btn-enregistrer').innerHTML = `✅ Enregistrer la transaction pour ${selectedOption.split('(')[0].trim()}`;
    }

    // Simule la recherche en tapant
    function simulerRecherche(searchText) {
        // En vrai, ceci déclencherait un appel AJAX/Firestore pour remplir le <select>
        // Ici, on met juste à jour l'affichage si l'utilisateur vide le champ.
        if (searchText.length < 3) {
             document.getElementById('montant-du-value').textContent = `$ 0.00`;
             document.getElementById('classe').value = '';
        } else {
             // Simuler la sélection automatique après recherche
             document.getElementById('eleve-selectionne').value = 'ID001';
             mettreAJourStatut('ID001');
        }
    }
    
    // Simule l'action du bouton de soumission
    function simulerEnregistrement() {
        const montant = parseFloat(document.getElementById('montant-paye').value);
        const eleveNom = document.getElementById('eleve-selectionne').options[document.getElementById('eleve-selectionne').selectedIndex].text.split('(')[0].trim();
        
        if (isNaN(montant) || montant <= 0) {
            alert("Veuillez entrer un montant valide.");
            return;
        }

        alert(`Transaction enregistrée ! 
               Élève: ${eleveNom}
               Montant payé: $${montant.toFixed(2)}
               Nouveau solde restant: $300.00 (Simulé)
               
               Un reçu a été généré.`);
        
        // Vider le formulaire ou rediriger en production
        // window.location.href = 'liste-paiements.html'; 
    }
    
    // Chargement initial pour afficher les données par défaut
    document.addEventListener('DOMContentLoaded', () => {
        mettreAJourStatut('ID001');
    });

  </script>
</body>
</html>
