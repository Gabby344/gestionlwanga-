<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Liste des √âl√®ves - Institut Saint Charles Lwanga</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --bleu-fonce: #1e40af;
  --gris-fonce: #1f2937;
  --vert-action: #10b981;
  --orange-alerte: #f59e0b;
  --rouge-danger: #ef4444;
  --fond-principal: #f4f6f8;
  --ombre-legere: rgba(0,0,0,0.08);
  --indigo-secondaire: #4f46e5;
  --blanc: #ffffff;
}
body {
  font-family: 'Inter', sans-serif;
  background-color: var(--fond-principal);
  margin: 0;
  padding: 2rem 1rem;
  color: var(--gris-fonce);
}
h1 {
  text-align: center;
  font-size: 2rem;
  color: var(--bleu-fonce);
  margin-bottom: 0.2rem;
}
h2 {
  text-align: center;
  font-size: 1rem;
  font-weight: 400;
  color: #6b7280;
  margin-bottom: 2rem;
}
.container {
  max-width: 1300px;
  margin: auto;
}
/* Barre de contr√¥le */
.controls-bar {
  background-color: var(--blanc);
  padding: 1rem;
  border-radius: 8px;
  box-shadow: 0 2px 4px var(--ombre-legere);
  margin-bottom: 1.5rem;
  display: grid;
  gap: 1rem;
  grid-template-columns: 1fr;
}
@media(min-width:600px){.controls-bar{grid-template-columns:2fr 1fr 1fr 150px;align-items:center;}}
.input-group label{display:block;font-size:0.8rem;font-weight:600;color:#6b7280;margin-bottom:0.3rem;}
.input-group select,.input-group input[type="text"]{width:100%;padding:0.6rem;border:1px solid #d1d5db;border-radius:4px;box-sizing:border-box;}
.btn-ajouter-eleve{
  padding:0.75rem 1rem;
  border:none;
  border-radius:4px;
  font-weight:600;
  cursor:pointer;
  background-color: var(--vert-action);
  color:white;
  text-align:center;
  display:block;
  text-decoration:none;
  transition: background 0.2s;
}
.btn-ajouter-eleve:hover{background-color:#059669;}
#compteur{grid-column:1 / -1;font-weight:700;font-size:0.9rem;color:var(--bleu-fonce);padding-top:0.5rem;}

/* Tableau et cartes */
#elevesContainer{background-color:var(--blanc);border-radius:8px;box-shadow:0 4px 10px var(--ombre-legere);overflow-x:auto;}
.eleves-table{width:100%;border-collapse:collapse;display:none;min-width:800px;}
@media(min-width:768px){.eleves-table{display:table;}th,td{padding:0.75rem 1rem;text-align:left;border-bottom:1px solid #e5e7eb;}th{background-color:#f3f4f6;font-weight:600;text-transform:uppercase;font-size:0.75rem;}td.statut-paye{color:var(--vert-action);font-weight:600;}td.statut-partiel{color:var(--orange-alerte);font-weight:600;}td.statut-non-paye{color:var(--rouge-danger);font-weight:600;}.actions-cell{width:160px;text-align:center;}.btn-modifier,.btn-profil,.btn-supprimer{border:none;padding:0.5rem 0.6rem;border-radius:4px;font-size:0.8rem;cursor:pointer;color:white;margin-right:0.3rem;}.btn-modifier{background-color:var(--indigo-secondaire);}.btn-profil{background-color:var(--bleu-fonce);}.btn-supprimer{background-color:var(--rouge-danger);}}
.eleve-card{padding:1rem;border-bottom:1px solid #e5e7eb;display:block;}
@media(min-width:768px){.eleve-card{display:none;}}
.eleve-card h3{margin:0 0 0.5rem 0;font-size:1.1rem;color:var(--bleu-fonce);}
.eleve-card p{margin:0.25rem 0;font-size:0.9rem;}
.actions-card{margin-top:0.75rem;display:flex;gap:0.5rem;}
.btn-retour{display:block;text-align:center;margin-top:1.5rem;color:var(--gris-fonce);text-decoration:none;font-size:0.9rem;}
</style>
</head>
<body>
<div class="container">
<h1>üìö Gestion des Dossiers √âl√®ves</h1>
<h2>Liste compl√®te, filtres rapides et acc√®s aux profils d√©taill√©s</h2>

<div class="controls-bar">
  <div class="input-group">
    <label for="searchInput">Recherche Rapide</label>
    <input type="text" id="searchInput" placeholder="Nom, Post-nom, Pr√©nom ou Matricule..." oninput="filterEleves()"/>
  </div>
  <div class="input-group">
    <label for="filtreClasse">Filtrer par Classe</label>
    <select id="filtreClasse" onchange="filterEleves()">
      <option value="">Toutes les classes</option>
      <option value="6A">6√®me Commerciale A</option>
      <option value="5S">5√®me Scientifique</option>
      <option value="4H">4√®me Humanit√©s</option>
    </select>
  </div>
  <div class="input-group">
    <label for="filtrePaiement">Statut Paiement</label>
    <select id="filtrePaiement" onchange="filterEleves()">
      <option value="">Tous les statuts</option>
      <option value="Pay√©">Pay√©</option>
      <option value="Partiel">Partiel</option>
      <option value="Non pay√©">Non pay√©</option>
    </select>
  </div>
  <a href="ajouter-eleve.html" class="btn-ajouter-eleve">‚ûï Nouvel √âl√®ve</a>
  <p id="compteur">Chargement des donn√©es...</p>
</div>

<div id="elevesContainer"></div>
<a href="dashboard.html" class="btn-retour">‚Üê Retour au Tableau de Bord</a>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, getDocs, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAgv4TDYnR60TXnns-LISqbZTgcdLT31cc",
  authDomain: "gestionlwanga.firebaseapp.com",
  projectId: "gestionlwanga",
  storageBucket: "gestionlwanga.firebasestorage.app",
  messagingSenderId: "622604298611",
  appId: "1:622604298611:web:4ab4314ed3eec6826c3d06"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let elevesData = [];

async function loadEleves() {
  const snapshot = await getDocs(collection(db, "eleves"));
  elevesData = snapshot.docs.map(doc=>({id: doc.id, ...doc.data()}));
  filterEleves();
}

function getClasseNom(code){
  return {'6A':'6√®me Commerciale A','5S':'5√®me Scientifique','4H':'4√®me Humanit√©s'}[code]||code;
}
function getStatutClass(statut){
  if(statut==='Pay√©') return 'statut-paye';
  if(statut==='Partiel') return 'statut-partiel';
  return 'statut-non-paye';
}

function filterEleves(){
  const recherche = document.getElementById('searchInput').value.toLowerCase();
  const classeFiltre = document.getElementById('filtreClasse').value;
  const paiementFiltre = document.getElementById('filtrePaiement').value;

  const filtered = elevesData.filter(e=>{
    const nomComplet = `${e.nom} ${e.postNom} ${e.prenom} ${e.matricule}`.toLowerCase();
    return nomComplet.includes(recherche)
      && (!classeFiltre || e.classe===classeFiltre)
      && (!paiementFiltre || e.statut===paiementFiltre);
  });

  renderEleves(filtered);
  document.getElementById('compteur').textContent = `üìä ${filtered.length} √©l√®ves affich√©s sur ${elevesData.length} au total.`;
}

function renderEleves(data){
  if(data.length===0){
    document.getElementById('elevesContainer').innerHTML="<p style='text-align:center;padding:3rem;'>Aucun √©l√®ve trouv√©.</p>";
    return;
  }
  let tableHTML = `<table class="eleves-table">
                    <thead>
                      <tr>
                        <th>Matricule</th>
                        <th>Nom Complet</th>
                        <th>Classe</th>
                        <th>Statut Paiement</th>
                        <th class="actions-cell">Actions</th>
                      </tr>
                    </thead><tbody>`;
  let cardsHTML = '';
  data.forEach(e=>{
    const statutClass = getStatutClass(e.statut);
    const classeNom = getClasseNom(e.classe);
    const fullName = `${e.nom} ${e.postNom} ${e.prenom}`;
    tableHTML += `<tr>
                    <td>${e.matricule}</td>
                    <td>${fullName}</td>
                    <td>${classeNom}</td>
                    <td class="${statutClass}">${e.statut}</td>
                    <td class="actions-cell">
                      <button class="btn-profil" onclick="viewProfil('${e.id}')">üëÅÔ∏è Profil</button>
                      <button class="btn-modifier" onclick="editEleve('${e.id}')">‚úèÔ∏è</button>
                      <button class="btn-supprimer" onclick="deleteEleve('${e.id}')">üóëÔ∏è</button>
                    </td>
                  </tr>`;
    cardsHTML += `<div class="eleve-card">
                    <h3>${fullName} <span style="font-weight:400;font-size:0.8rem;color:#6b7280;">(${e.matricule})</span></h3>
                    <p>Classe: <strong>${classeNom}</strong></p>
                    <p>Paiement: <strong class="${statutClass}">${e.statut}</strong></p>
                    <div class="actions-card">
                      <button class="btn-profil" style="flex:1;background-color:var(--bleu-fonce);" onclick="viewProfil('${e.id}')">üëÅÔ∏è Voir Profil</button>
                      <button class="btn-modifier" style="flex:1;background-color:var(--indigo-secondaire);" onclick="editEleve('${e.id}')">‚úèÔ∏è Modifier</button>
                      <button class="btn-supprimer" style="flex:1;background-color:var(--rouge-danger);" onclick="deleteEleve('${e.id}')">üóëÔ∏è Supprimer</button>
                    </div>
                  </div>`;
  });
  tableHTML += '</tbody></table>';
  document.getElementById('elevesContainer').innerHTML = tableHTML + cardsHTML;
}

function viewProfil(id){ alert(`Voir profil de l'√©l√®ve ID: ${id}`); }
function editEleve(id){ alert(`Modifier √©l√®ve ID: ${id}`); }

async function deleteEleve(id){
  if(confirm("‚ö†Ô∏è Voulez-vous vraiment supprimer cet √©l√®ve ?")){
    await deleteDoc(doc(db, "eleves", id));
    elevesData = elevesData.filter(e=>e.id!==id);
    filterEleves();
  }
}

document.addEventListener('DOMContentLoaded', ()=>loadEleves());
</script>
</body>
</html>
