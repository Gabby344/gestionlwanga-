<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Connexion - Gestion Lwanga</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Poppins", sans-serif; }
    body {
      background: linear-gradient(135deg, #004e92, #000428);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .login-container {
      background: #fff;
      width: 100%;
      max-width: 400px;
      padding: 2.5rem;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      text-align: center;
      animation: fadeIn 0.8s ease-in-out;
    }
    h2 { margin-bottom: 1.5rem; color: #004e92; font-weight: 600; }
    form { display: flex; flex-direction: column; gap: 1rem; text-align: left; }
    input {
      padding: 0.75rem 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    input:focus { outline: none; border-color: #004e92; box-shadow: 0 0 0 2px rgba(0, 78, 146, 0.15); }
    button {
      background: #004e92; color: #fff; padding: 0.9rem 1rem; font-size: 1rem; border: none;
      border-radius: 8px; cursor: pointer; transition: background 0.3s ease, transform 0.1s ease;
    }
    button:hover { background: #003d75; }
    button:active { transform: scale(0.98); }
    #errorMessage { margin-top: 1rem; color: #d93025; font-size: 0.9rem; min-height: 20px; }
    .register-link { margin-top: 1.5rem; font-size: 0.95rem; }
    .register-link a { color: #004e92; font-weight: 500; text-decoration: none; transition: color 0.2s; }
    .register-link a:hover { color: #002b57; text-decoration: underline; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    @media (max-width: 480px) { .login-container { padding: 1.5rem; } h2 { font-size: 1.4rem; } }
  </style>
</head>
<body>
  <div class="login-container">
    <h2>Connexion √† votre compte</h2>
    <form id="loginForm">
      <input id="email" type="email" placeholder="Email" required>
      <input id="password" type="password" placeholder="Mot de passe" required>
      <button type="submit">Se connecter</button>
    </form>
    <p id="errorMessage"></p>
    <div class="register-link">
      Pas encore de compte ? <a href="register.html">Cr√©er un compte</a>
    </div>
  </div>

  <script type="module">
    import { auth, db } from "./js/config.js";
    import { signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const form = document.getElementById("loginForm");
    const errorMessage = document.getElementById("errorMessage");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      errorMessage.textContent = "";

      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;

      try {
        // üîê Connexion utilisateur
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        // üìÑ R√©cup√©rer le r√¥le depuis Firestore
        const userDoc = await getDoc(doc(db, "users", user.uid));
        if (!userDoc.exists()) throw new Error("Profil utilisateur introuvable.");

        const role = userDoc.data().role || "inconnu";

        // üöÄ Redirection selon r√¥le
        switch (role) {
          case "prefet":
            window.location.href = "dashboard_prefet.html"; break;
          case "admin":
            window.location.href = "dashboard_admin.html"; break;
          case "directeur_etudes":
            window.location.href = "dashboard_directeur_etudes.html"; break;
          case "directeur_discipline":
            window.location.href = "dashboard_directeur_discipline.html"; break;
          case "secretaire":
            window.location.href = "dashboard_secretaire.html"; break;
          case "econome":
            window.location.href = "dashboard_econome.html"; break;
          case "enseignant":
            window.location.href = "dashboard_enseignant.html"; break;
          case "eleve":
            window.location.href = "dashboard_eleve.html"; break;
          default:
            throw new Error("R√¥le utilisateur inconnu : " + role);
        }
      } catch (error) {
        errorMessage.textContent = "‚ùå " + error.message;
      }
    });
  </script>
</body>
</html>
