<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Accueil Admin · Institut Saint Charles Lwanga</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f9fafb;
      margin: 0;
      padding: 2rem;
      color: #374151;
    }
    h1 {
      text-align: center;
      color: #1e3a8a;
      margin-bottom: 1rem;
    }
    .welcome {
      text-align: center;
      margin-bottom: 2rem;
      font-size: 1.1rem;
    }
    .modules {
      max-width: 600px;
      margin: auto;
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
    }
    .module {
      background-color: white;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.05);
      text-align: center;
      font-weight: 600;
      color: #1e3a8a;
      text-decoration: none;
      transition: background 0.2s;
    }
    .module:hover {
      background-color: #e0e7ff;
    }
    footer {
      margin-top: 3rem;
      text-align: center;
      font-size: 0.85rem;
      color: #6b7280;
    }
  </style>
</head>
<body>
  <h1>🏫 Espace Administratif</h1>
  <div class="welcome" id="welcomeMsg">Chargement...</div>
  <div class="modules" id="moduleList"></div>

  <footer>
    &copy; 2025 · Institut Saint Charles Lwanga · Lubumbashi
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "TON_API_KEY",
      authDomain: "TON_DOMAINE.firebaseapp.com",
      projectId: "TON_PROJECT_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const welcomeMsg = document.getElementById("welcomeMsg");
    const moduleList = document.getElementById("moduleList");

    const modulesParRole = {
      prefet: [
        { label: "👥 Utilisateurs", url: "liste-utilisateurs.html" },
        { label: "📚 Cours", url: "cours.html" },
        { label: "📝 Bulletins", url: "bulletins.html" },
        { label: "📋 Sanctions", url: "discipline.html" },
        { label: "📄 Inscriptions", url: "inscriptions.html" },
        { label: "💰 Paiements", url: "paiements.html" }
      ],
      directeur_etudes: [
        { label: "📚 Cours", url: "cours.html" },
        { label: "📝 Bulletins", url: "bulletins.html" }
      ],
      directeur_discipline: [
        { label: "📋 Sanctions", url: "discipline.html" },
        { label: "📆 Présences", url: "presences.html" }
      ],
      secretaire: [
        { label: "📄 Inscriptions", url: "inscriptions.html" },
        { label: "📁 Documents", url: "documents.html" }
      ],
      econome: [
        { label: "💰 Paiements", url: "paiements.html" },
        { label: "📊 Rapports financiers", url: "rapports.html" }
      ]
    };

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const docRef = doc(db, "utilisateurs", user.uid);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
          const data = docSnap.data();
          const nomComplet = `${data.nom} ${data.postNom} ${data.prenom}`;
          const role = data.role;

          welcomeMsg.textContent = `Bienvenue ${nomComplet} · Rôle : ${role}`;

          const modules = modulesParRole[role] || [];
          modules.forEach(mod => {
            const link = document.createElement("a");
            link.className = "module";
            link.href = mod.url;
            link.textContent = mod.label;
            moduleList.appendChild(link);
          });
        } else {
          welcomeMsg.textContent = "Utilisateur non reconnu.";
        }
      } else {
        window.location.href = "connexion.html";
      }
    });
  </script>
</body>
</html>
