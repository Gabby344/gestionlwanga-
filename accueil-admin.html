<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Accueil Â· Institut Saint Charles Lwanga</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://kit.fontawesome.com/a2e0e6a56b.js" crossorigin="anonymous"></script>
  <script type="module" src="authGuard.js"></script>
  <script type="module" src="header.js"></script>
</head>
<body class="bg-gray-50 text-gray-900 flex h-screen">

  <!-- Sidebar -->
  <aside class="w-64 bg-blue-900 text-white flex flex-col">
    <div class="p-6 text-2xl font-bold border-b border-blue-800">
      ðŸ‘‘ Admin
    </div>
    <nav class="flex-1 p-4 space-y-3">
      <a href="dashboard-admin.html" class="flex items-center gap-3 p-3 hover:bg-blue-800 rounded-lg transition"><i class="fa-solid fa-chart-line"></i> Tableau de bord</a>
      <a href="liste-utilisateurs.html" class="flex items-center gap-3 p-3 hover:bg-blue-800 rounded-lg transition"><i class="fa-solid fa-users"></i> Utilisateurs</a>
      <a href="cours.html" class="flex items-center gap-3 p-3 hover:bg-blue-800 rounded-lg transition"><i class="fa-solid fa-book"></i> Cours</a>
      <a href="bulletins.html" class="flex items-center gap-3 p-3 hover:bg-blue-800 rounded-lg transition"><i class="fa-solid fa-file-lines"></i> Bulletins</a>
      <a href="paiements.eleves.html" class="flex items-center gap-3 p-3 hover:bg-blue-800 rounded-lg transition"><i class="fa-solid fa-money-bill-wave"></i> Paiements</a>
      <a href="admin.html" class="flex items-center gap-3 p-3 hover:bg-blue-800 rounded-lg transition"><i class="fa-solid fa-gear"></i> ParamÃ¨tres</a>
    </nav>
    <button id="logoutBtn" class="m-4 bg-red-600 hover:bg-red-700 p-2 rounded-lg flex items-center justify-center gap-2"><i class="fa-solid fa-right-from-bracket"></i> DÃ©connexion</button>
  </aside>

  <!-- Main content -->
  <main class="flex-1 p-8 overflow-y-auto">
    <header class="mb-6" id="mainHeader"></header>

    <div class="text-center mb-8 text-lg font-medium" id="welcomeMsg">Chargement du profil...</div>

    <section class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6" id="moduleList">
      <!-- Modules gÃ©nÃ©rÃ©s dynamiquement -->
    </section>
  </main>

  <script type="module">
    import { auth, db } from './config.js';
    import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const welcomeMsg = document.getElementById("welcomeMsg");
    const moduleList = document.getElementById("moduleList");
    const logoutBtn = document.getElementById("logoutBtn");

    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
      window.location.href = "login.html";
    });

    const modulesParRole = {
      admin: [
        { icon: "fa-chart-line", label: "Tableau de bord", url: "dashboard-admin.html" },
        { icon: "fa-users", label: "Utilisateurs", url: "liste-utilisateurs.html" },
        { icon: "fa-book", label: "Cours", url: "cours.html" },
        { icon: "fa-file-lines", label: "Bulletins", url: "bulletins.html" },
        { icon: "fa-money-bill-wave", label: "Paiements", url: "paiements.eleves.html" },
        { icon: "fa-gear", label: "ParamÃ¨tres", url: "admin.html" }
      ]
    };

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      const docRef = doc(db, "users", user.uid);
      const docSnap = await getDoc(docRef);

      if (!docSnap.exists()) {
        welcomeMsg.textContent = "â›” Profil introuvable.";
        return;
      }

      const data = docSnap.data();
      const nomComplet = [data.nom, data.postNom, data.prenom].filter(Boolean).join(" ") || "Utilisateur";
      const role = data.role?.toLowerCase().trim() || "inconnu";

      welcomeMsg.textContent = `Bienvenue ${nomComplet} Â· RÃ´le : ${role}`;

      const modules = modulesParRole[role] || [];
      if (!modules.length) {
        moduleList.innerHTML = "<p class='text-center col-span-full'>â›” Aucun module disponible pour ce rÃ´le.</p>";
        return;
      }

      modules.forEach(mod => {
        const link = document.createElement("a");
        link.href = mod.url;
        link.className = "bg-white shadow rounded-xl p-6 hover:shadow-lg transition flex flex-col items-center gap-2 text-blue-900 font-semibold";
        link.innerHTML = `<i class="fa-solid ${mod.icon} text-3xl"></i><span>${mod.label}</span>`;
        moduleList.appendChild(link);
      });
    });
  </script>
</body>
</html>
